@page
@model PCM_357.Pages.Admin.Bookings.IndexModel
@{ ViewData["Title"] = "Quản lý Đặt sân"; }

<h1>Quản lý Đặt sân (Admin)</h1>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Mã</th>
            <th>Hội viên</th>
            <th>Sân</th>
            <th>Bắt đầu</th>
            <th>Kết thúc</th>
            <th>Trạng thái</th>
            <th>Ghi chú</th>
            <th>Thao tác</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Bookings)
        {
            <tr>
                <td>#@item.Id</td>
                <td>@item.Member?.FullName</td>
                <td>@item.Court?.Name</td>
                <td>@item.StartTime.ToString("dd/MM HH:mm")</td>
                <td>@item.EndTime.ToString("HH:mm")</td>
                <td>
                    <span class="badge @(item.Status == PCM_357.Entities.BookingStatus.Confirmed ? "bg-success" : (item.Status == PCM_357.Entities.BookingStatus.Cancelled ? "bg-danger" : "bg-warning"))">
                        @item.Status
                    </span>
                </td>
                <td>@item.Notes</td>
                <td>
                    @if (item.Status == PCM_357.Entities.BookingStatus.Confirmed)
                    {
                        <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#cancelModal" data-id="@item.Id">
                            Hủy
                        </button>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Cancel Confirmation Modal -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">Xác nhận Hủy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn <strong>Hủy lịch đặt sân</strong> này không?</p>
                <p class="text-danger small"><i class="bi bi-info-circle"></i> Trạng thái sẽ chuyển thành Cancelled và không thể hoàn tác.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Không</button>
                <form method="post" asp-page-handler="Cancel" id="cancelForm">
                    <input type="hidden" name="id" id="cancelId" value="" />
                    <button type="submit" class="btn btn-danger">Xác nhận Hủy</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        var cancelModal = document.getElementById('cancelModal');
        cancelModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var id = button.getAttribute('data-id');
            var inputId = cancelModal.querySelector('#cancelId');
            inputId.value = id;
        })
    </script>
}
